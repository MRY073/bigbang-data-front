var k=(N,l,_)=>new Promise((g,f)=>{var b=p=>{try{y(_.next(p))}catch(u){f(u)}},T=p=>{try{y(_.throw(p))}catch(u){f(u)}},y=p=>p.done?g(p.value):Promise.resolve(p.value).then(b,T);y((_=_.apply(N,l)).next())});import{d as z,a as I,k as m,e as d,g as n,b as x,f as C,w,F as K,l as L,h as S,j as E,v as F,i as D,t as h,fK as v,fL as j,_ as R}from"./index-CrpkX2s8.js";const Y={class:"trial-monitor-page"},q={class:"controls"},G={key:1,class:"grid"},J={class:"card-top"},Q={class:"img-area"},W=["src"],X={key:1,class:"thumb placeholder"},Z={class:"info-area"},tt=["onClick"],et=["title"],st={class:"tags"},at={class:"card-metrics"},ot={class:"metric"},nt={class:"value"},rt={class:"metric"},it={class:"value"},ct={class:"metric"},lt={class:"value"},dt={class:"card-foot"},ut={key:0,class:"hint"},_t="/api/products/testing-monitor",pt=z({name:"TrialLinkMonitor",__name:"index",setup(N){const l=I([]),_=I(!1),g=I("1489850435"),f=[{label:"Modern Nest|泰国",value:"1489850435"},{label:"shop07|泰国",value:"1638595255"}];function b(e="加载中..."){return j.service({lock:!0,text:e,background:"rgba(0,0,0,0.2)"})}function T(e){return e.toLocaleString("zh-CN")}function y(e){if(!e)return"未设置";try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(t){const s=parseInt(t[1],10),r=parseInt(t[2],10),i=parseInt(t[3],10);if(s>=1900&&s<=2100&&r>=1&&r<=12&&i>=1&&i<=31)return`${s}-${String(r).padStart(2,"0")}-${String(i).padStart(2,"0")}`}const o=new Date(e);if(!isNaN(o.getTime())){const s=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");return`${s}-${r}-${i}`}return"日期格式错误"}catch(t){return"日期格式错误"}}function p(e){if(!e)return!1;try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)return!1;const o=parseInt(t[1],10),s=parseInt(t[2],10)-1,r=parseInt(t[3],10),i=new Date(o,s,r),c=new Date;c.setHours(0,0,0,0),i.setHours(0,0,0,0);const a=c.getTime()-i.getTime();return Math.floor(a/(1e3*60*60*24))>=15}catch(t){return!1}}function u(e){const t=e.total_visitors,o=e.total_orders,s=p(e.testing_stage_start);return t>100||o>6||s?"finished":t>=50&&t<=100||o>=3&&o<=6?"watching":"normal"}function M(e){const t=u(e);return t==="finished"?"card-status-finished":t==="watching"?"card-status-watching":"card-status-normal"}function O(e){const t=u(e);return t==="finished"?"测款已完成，需马上处理":t==="watching"?"数据优秀情况下及时转为潜力款，需尽快处理":""}function U(e){return e==="finished"?1:e==="watching"?2:3}function $(e){return[...e].sort((t,o)=>{const s=u(t),r=u(o);return U(s)-U(r)})}function P(){const e=new Date,t=new Date(e);t.setDate(e.getDate()-20);const o=new Date(e);o.setDate(e.getDate()-10);const s=new Date(e);s.setDate(e.getDate()-5),l.value=[{product_id:"SKU-T1001",product_name:"测款 — 轻便跑鞋",product_image:"https://via.placeholder.com/160?text=T1001",testing_stage_start:t.toISOString().split("T")[0],total_orders:2,total_visitors:60},{product_id:"SKU-T1002",product_name:"测款 — 多功能杯",product_image:"https://via.placeholder.com/160?text=T1002",testing_stage_start:o.toISOString().split("T")[0],total_orders:7,total_visitors:85},{product_id:"SKU-T1003",product_name:"测款 — 智能照明灯",product_image:"https://via.placeholder.com/160?text=T1003",testing_stage_start:s.toISOString().split("T")[0],total_orders:4,total_visitors:120},{product_id:"SKU-T1004",product_name:"测款 — 创意手机支架",product_image:null,testing_stage_start:s.toISOString().split("T")[0],total_orders:5,total_visitors:75},{product_id:"SKU-T1005",product_name:"测款 — 多彩背包",product_image:"https://via.placeholder.com/160?text=T1005",testing_stage_start:o.toISOString().split("T")[0],total_orders:1,total_visitors:65},{product_id:"SKU-T1006",product_name:"测款 — 简约水杯",product_image:"https://via.placeholder.com/160?text=T1006",testing_stage_start:s.toISOString().split("T")[0],total_orders:0,total_visitors:30},{product_id:"SKU-T1007",product_name:"测款 — 运动手环",product_image:"https://via.placeholder.com/160?text=T1007",testing_stage_start:o.toISOString().split("T")[0],total_orders:2,total_visitors:45}]}function V(){return k(this,null,function*(){var t,o;if(!g.value){v.warning("请先选择店铺");return}_.value=!0;const e=b("拉取数据中...");try{const s=f.find(a=>a.value===g.value);if(!s)throw new Error("店铺信息不存在");const r=new URL(_t,window.location.origin);r.searchParams.append("shopID",g.value),r.searchParams.append("shopName",s.label);const i=yield fetch(r.toString());if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const c=yield i.json();if(c.success&&c.data){const a=c.data;l.value=$(a),l.value.length===0?v.info("当前店铺暂无测款商品"):v.success(c.message||`查询成功，共 ${l.value.length} 条数据`)}else throw new Error(c.error||c.message||"查询失败")}catch(s){console.error("拉取数据失败:",s),(t=s==null?void 0:s.message)!=null&&t.includes("HTTP error")||(o=s==null?void 0:s.message)!=null&&o.includes("fetch")?(P(),l.value=$(l.value),v.info("使用本地示例数据（后端不可用）")):(v.error((s==null?void 0:s.message)||"网络连接失败，请检查网络后重试"),l.value=[])}finally{e.close(),_.value=!1}})}function B(e){var s;const t=e.target;t.style.display="none";const o=document.createElement("div");o.className="thumb placeholder",o.textContent="无图",(s=t.parentElement)==null||s.appendChild(o)}function A(e){return k(this,null,function*(){try{if(navigator.clipboard&&navigator.clipboard.writeText)yield navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}v.success("已复制到剪贴板")}catch(t){v.error("复制失败")}})}return(e,t)=>{const o=S("el-option"),s=S("el-select"),r=S("el-button"),i=S("el-empty"),c=S("el-tag");return d(),m("div",Y,[n("div",q,[C(s,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"}},{default:w(()=>[(d(),m(K,null,L(f,a=>C(o,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),C(r,{type:"primary",loading:_.value,icon:"el-icon-refresh",onClick:V},{default:w(()=>[...t[1]||(t[1]=[E("拉取数据",-1)])]),_:1},8,["loading"])]),!_.value&&l.value.length===0&&g.value?(d(),x(i,{key:0,description:"当前店铺暂无测款商品","image-size":120})):(d(),m("div",G,[(d(!0),m(K,null,L(l.value,a=>(d(),m("div",{key:a.product_id,class:F(["prod-card",M(a)])},[n("div",J,[n("div",Q,[a.product_image?(d(),m("img",{key:0,src:a.product_image,alt:"主图",class:"thumb",onError:B},null,40,W)):D("",!0),a.product_image?D("",!0):(d(),m("div",X,"无图"))]),n("div",Z,[n("div",{class:"id",title:"点击复制ID",onClick:H=>A(a.product_id)},h(a.product_id),9,tt),n("div",{class:"name",title:a.product_name},h(a.product_name),9,et),n("div",st,[u(a)==="finished"?(d(),x(c,{key:0,type:"danger"},{default:w(()=>[...t[2]||(t[2]=[E("测款完毕",-1)])]),_:1})):u(a)==="watching"?(d(),x(c,{key:1,type:"warning"},{default:w(()=>[...t[3]||(t[3]=[E("测款关注中",-1)])]),_:1})):D("",!0)])])]),n("div",at,[n("div",ot,[t[4]||(t[4]=n("div",{class:"label"},"测款日期开始",-1)),n("div",nt,h(y(a.testing_stage_start)),1)]),n("div",rt,[t[5]||(t[5]=n("div",{class:"label"},"出单数",-1)),n("div",it,h(T(a.total_orders)),1)]),n("div",ct,[t[6]||(t[6]=n("div",{class:"label"},"累计访客",-1)),n("div",lt,h(T(a.total_visitors)),1)])]),n("div",dt,[O(a)?(d(),m("div",ut,h(O(a)),1)):D("",!0)])],2))),128))]))])}}}),vt=R(pt,[["__scopeId","data-v-de13ae72"]]);export{vt as default};
