var L=(D,y,c)=>new Promise((u,s)=>{var b=_=>{try{g(c.next(_))}catch(x){s(x)}},V=_=>{try{g(c.throw(_))}catch(x){s(x)}},g=_=>_.done?u(_.value):Promise.resolve(_.value).then(b,V);g((c=c.apply(D,y)).next())});import{g2 as W,d as j,a as w,n as H,k as C,e as k,g as n,f as l,w as a,h as f,F as z,l as R,u as p,gV as K,t as U,gW as X,b as q,i as S,gX as Y,j as E,gY as Z,gZ as A,g_ as G,g$ as J,H as P,h0 as Q,h1 as ee,h2 as le,fK as i,_ as ae}from"./index-CrpkX2s8.js";const se=D=>W.request("post","/api/upload",{data:D},{headers:{},timeout:6e4*10}),te={class:"data-upload-page"},oe={class:"main-content"},ne={class:"card-header"},ue={class:"radio-content"},de={class:"file-summary-card"},re={class:"summary-item"},ie={class:"summary-info"},pe={class:"summary-value"},fe={class:"card-header"},ce={class:"upload-area"},_e={class:"upload-trigger"},ve={class:"upload-tip"},me={class:"action-buttons"},ge=j({name:"DataUpload",__name:"index",setup(D){const y=w(),c=w(),u=w({type:"",shop:""}),s=w([]),b=w(!1),V=[{label:"广告文件上传（单日）",value:"ad"},{label:"每日文件上传（单日）",value:"daily"},{label:"商品ID更新（全量）",value:"productID"}],g=[{label:"Modern Nest|泰国",value:"1489850435"},{label:"shop07|泰国",value:"1638595255"}],_=d=>/\.(csv|xls|xlsx)$/i.test(d),x=d=>_(d.name)?u.value.type?u.value.type==="productID"?s.value.length>=1?(i.error("商品ID更新（全量）类型只能上传一个文件!"),!1):!0:s.value.length<100?!0:(i.error("最多只能上传100个文件!"),!1):(i.error("请先选择上传类型!"),!1):(i.error("只能上传 .csv, .xls, .xlsx 格式的文件!"),!1),T=d=>L(null,null,function*(){var v,h;if(!d)return;if(!u.value.shop){i.warning("请先选择店铺");return}if(!u.value.type){i.warning("请先选择上传类型");return}if(!s.value||!s.value.length){i.warning("请先选择要上传的文件");return}const e=s.value.map(o=>o.raw instanceof File?o.raw:void 0).filter(Boolean);if(!e.length){i.warning("无有效文件可上传");return}const t=new FormData;e.forEach((o,N)=>t.append("files",o)),t.append("type",u.value.type);const m=g.find(o=>o.value===u.value.shop);m&&(t.append("shopID",u.value.shop),t.append("shopName",m.label)),b.value=!0,I(),i.info("上传请求已发送，正在后台处理...");try{const o=yield se(t);o.success?i.success(o.message||"文件上传完成"):i.error(o.message||"上传失败，请重试")}catch(o){console.error("上传错误:",o),i.error(((h=(v=o==null?void 0:o.response)==null?void 0:v.data)==null?void 0:h.message)||(o==null?void 0:o.message)||"上传失败，请重试")}finally{b.value=!1}}),$=P(d=>{T(d)},1e3,!0),I=()=>{var d,e;(d=y.value)==null||d.resetFields(),s.value=[],(e=c.value)==null||e.clearFiles()};return H(()=>u.value.type,(d,e)=>{var t,m,v;d&&d==="productID"&&s.value.length>1&&(s.value=[s.value[0]],(t=c.value)==null||t.clearFiles(),(m=s.value[0])!=null&&m.raw&&((v=c.value)==null||v.handleStart(s.value[0].raw)),i.warning("商品ID更新（全量）类型只能上传一个文件，已自动清除多余文件"))}),(d,e)=>{const t=f("el-icon"),m=f("el-radio-button"),v=f("el-radio-group"),h=f("el-form-item"),o=f("el-radio"),N=f("el-progress"),F=f("el-button"),M=f("el-form"),B=f("el-card"),O=f("el-upload");return k(),C("div",te,[n("div",oe,[l(B,{class:"config-card",shadow:"hover"},{header:a(()=>[n("div",ne,[l(t,null,{default:a(()=>[l(p(A))]),_:1}),e[4]||(e[4]=n("span",null,"上传配置",-1))])]),default:a(()=>[l(M,{ref_key:"formRef",ref:y,model:u.value,"label-width":"140px",class:"upload-form"},{default:a(()=>[l(h,{label:"选择店铺",prop:"shop",required:""},{default:a(()=>[l(v,{modelValue:u.value.shop,"onUpdate:modelValue":e[0]||(e[0]=r=>u.value.shop=r),class:"type-group shop-group"},{default:a(()=>[(k(),C(z,null,R(g,r=>l(m,{key:r.value,label:r.value,class:"shop-radio"},{default:a(()=>[l(t,{class:"radio-icon"},{default:a(()=>[l(p(K))]),_:1}),n("span",null,U(r.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"上传类型",prop:"type",required:""},{default:a(()=>[l(v,{modelValue:u.value.type,"onUpdate:modelValue":e[1]||(e[1]=r=>u.value.type=r),class:"type-group"},{default:a(()=>[(k(),C(z,null,R(V,r=>l(o,{key:r.value,label:r.value,class:"type-radio",border:""},{default:a(()=>[n("div",ue,[l(t,{class:"radio-icon"},{default:a(()=>[l(p(X))]),_:1}),n("span",null,U(r.label),1)])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"文件统计"},{default:a(()=>[n("div",de,[n("div",re,[l(t,{class:"summary-icon"},{default:a(()=>[l(p(Y))]),_:1}),n("div",ie,[e[5]||(e[5]=n("span",{class:"summary-label"},"已选文件",-1)),n("span",pe,U(s.value.length)+" / 100",1)])]),l(N,{percentage:s.value.length/100*100,"stroke-width":8,"show-text":!1,class:"progress-bar"},null,8,["percentage"]),s.value.length?(k(),q(F,{key:0,type:"danger",size:"small",plain:"",onClick:I},{default:a(()=>[l(t,null,{default:a(()=>[l(p(Z))]),_:1}),e[6]||(e[6]=E(" 清空全部 ",-1))]),_:1})):S("",!0)])]),_:1})]),_:1},8,["model"])]),_:1}),l(B,{class:"upload-card",shadow:"hover"},{header:a(()=>[n("div",fe,[l(t,null,{default:a(()=>[l(p(le))]),_:1}),e[7]||(e[7]=n("span",null,"文件上传",-1))])]),default:a(()=>[n("div",ce,[l(O,{ref_key:"uploadRef",ref:c,"file-list":s.value,"onUpdate:fileList":e[2]||(e[2]=r=>s.value=r),class:"upload-demo","auto-upload":!1,"show-file-list":!0,"before-upload":x,multiple:u.value.type&&u.value.type!=="productID",accept:".csv,.xls,.xlsx",action:"#",drag:""},{trigger:a(()=>[n("div",_e,[l(t,{class:"upload-icon",size:48},{default:a(()=>[l(p(J))]),_:1}),e[8]||(e[8]=n("p",{class:"upload-text"},"点击或拖拽文件到此区域上传",-1)),e[9]||(e[9]=n("p",{class:"upload-hint"},"支持 .csv / .xls / .xlsx 格式文件",-1))])]),tip:a(()=>[n("div",ve,[l(t,null,{default:a(()=>[l(p(G))]),_:1}),e[10]||(e[10]=n("span",null,"请勿修改文件名、文件格式或文件内容",-1))])]),_:1},8,["file-list","multiple"])]),n("div",me,[l(F,{type:"primary",size:"large",class:"submit-btn",disabled:!s.value.length||!u.value.shop||!u.value.type,loading:b.value,onClick:e[3]||(e[3]=r=>p($)(y.value))},{default:a(()=>[l(t,null,{default:a(()=>[l(p(Q))]),_:1}),e[11]||(e[11]=E(" 提交上传 ",-1))]),_:1},8,["disabled","loading"]),s.value.length?(k(),q(F,{key:0,size:"large",class:"cancel-btn",onClick:I},{default:a(()=>[l(t,null,{default:a(()=>[l(p(ee))]),_:1}),e[12]||(e[12]=E(" 取消并清空 ",-1))]),_:1})):S("",!0)])]),_:1})])])}}}),be=ae(ge,[["__scopeId","data-v-da720e2b"]]);export{be as default};
